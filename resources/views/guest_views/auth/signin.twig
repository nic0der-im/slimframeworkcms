<!DOCTYPE html>
<html lang="es">
	<head>
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-98062930-1"></script>
		<script>
		  window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments);}
		  gtag('js', new Date());

		  gtag('config', 'UA-98062930-1');
		</script>
		<!-- GOOGLE -->

		<!-- Facebook Pixel Code -->
		<script>
		!function(f,b,e,v,n,t,s)
		{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
		n.callMethod.apply(n,arguments):n.queue.push(arguments)};
		if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
		n.queue=[];t=b.createElement(e);t.async=!0;
		t.src=v;s=b.getElementsByTagName(e)[0];
		s.parentNode.insertBefore(t,s)}(window,document,'script',
		'https://connect.facebook.net/en_US/fbevents.js');


		fbq('init', '215762682248425'); 
		fbq('track', 'PageView');
		</script>
		<!-- End Facebook Pixel Code -->
		<meta name="robots" content="noindex,follow" />
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
		<meta name="author" content="Ciro Automotores" />
		<meta property="og:locale" content="es_AR" />
		<meta property="og:site_name" content="Ciro Automotores Argentina" />
		<meta property="og:url" content="{{base_url()}}{{current_path}}" />
		{% if 'contacto' in return_url%}
			<meta property="og:title" content="Ciro Automotores - Inicia sesión y hacé contacto con nosotros para comprar los autos usados en Salta que vos quieras" />
			<meta property="og:description" content="¡Inicia sesión en Ciro Automotores! Encontrá los mejores autos usados en Salta y Jujuy. !Te esperamos!" />
			<meta name="description" content="Hacé contacto con Ciro Automotores, para comprar autos usados en Salta y Jujuy. También tiene autos 0 kilómetros." />
  		<meta name="keywords" content="iniciar sesión ciro automotores" />
			<title>Autos Usados Salta | Contacto | Iniciar Sesión | Ciro Automotores</title>
		{% elseif 'nosotros' in return_url %}
			<meta property="og:title" content="Ciro Automotores - ¡Hacé contacto con nosotros! Tenemos los mejores autos usados en Salta y Jujuy además de vender autos 0 KM" />
			<meta property="og:description" content="¡Inicia sesión! Nosotros tenemos los mejores autos usados en Salta y Jujuy además de autos 0 KM. ¡Hacé contacto!" />
			<meta name="description" content="Ciro Automotores vende autos usados en Salta y en Jujuy además de tener autos 0 KM." />
  		<meta name="keywords" content="autos usados salta, autos usados en salta, autos 0 km" />
			<title>Autos Usados Salta | Nosotros | Iniciar Sesión | Ciro Automotores</title>
		{% elseif 'vendetuauto' in return_url %}
			<meta property="og:title" content="Ciro Automotores - ¡Inicia tu sesión y vende tu auto! Tenemos los mejores autos usados en Salta y Jujuy" />
			<meta property="og:description" content="¡Inicia sesión y encontrá el auto que deseas! Tenemos autos usados en Salta y Jujuy. ¡Hacé contacto!" />
			<meta name="description" content="¡Vende tu auto en Ciro Automotores! Vendemos autos usados en Salta y Jujuy además de autos 0 KM." />
  		<meta name="keywords" content="autos usados salta, autos usados en salta, autos 0 km" />
			<title>Autos Usados Salta | Vende tu Auto | Iniciar Sesión | Ciro Automotores</title>
		{% elseif 'preguntasfrecuentes' in return_url %}
			<meta property="og:title" content="Ciro Automotores - ¡Hacé las preguntas que vos quieras! Vendemos los mejores autos usados en Salta y Jujuy. ¡Te esperamos!" />
			<meta property="og:description" content="¡Hacé contacto y realiza las preguntas que quieras! Tenemos los mejores autos en Jujuy y Salta. ¡Te esperamos!" />
			<meta name="description" content="En Ciro Automotores respondemos a todas tus preguntas. Podés comprar autos usados en Salta y autos usados en Jujuy. ¡Visítanos!" />
  		<meta name="keywords" content="autos usados salta, autos usados en salta, autos usados en jujuy" />
			<title>Autos Usados Salta | Preguntas Frecuentes | Iniciar Sesión | Ciro Automotores</title>
		{% elseif return_url is not defined %}
			<meta property="og:title" content="Ciro Automotores - Inicia sesión y compra autos usados en Salta y Jujuy además tenemos autos 0 KM" />
			<meta property="og:description" content="¡Inicia sesión y hacé contacto con Ciro Automotores! Encontrá los mejores autos usados en Salta y Jujuy. ¡Te esperamos!" />
			<meta name="description" content="Te esperamos en Ciro Automotores donde podés encontrar autos usados en Salta y Jujuy. Además también hay autos 0 KM. ¡Hacé contacto!" />
  		<meta name="keywords" content="autos usados salta, autos usados en salta, autos 0 km" />
			<title>Autos Usados Salta | Iniciar Sesión | Ciro Automotores</title>
		{% elseif publicacion %}
			<meta property="og:title" content="Ciro Automotores - Compra de autos usados en Salta y Jujuy {{ publicacion.titulo }}"/>
			<meta property="og:description" content="¡Inicia sesión y compra los mejores autos usados en Salta y Jujuy además de autos 0 KM. Compra la marca {{ publicacion.titulo }}."/>
			<meta name="description" content="Si buscas el modelo {{ publicacion.titulo }} en Ciro Automotores contamos con autos usados Salta y Jujuy al igual que autos 0 KM. ¡Visítanos!" />
  		<meta name="keywords" content="{{ publicacion.titulo | lower }} salta" />
			<title>{{publicacion.titulo}} | Iniciar sesión | Ciro Automotores</title>
		{% elseif filtros %}
			{% if filtros.marca.show is defined %}
			{% set showMarca = filtros.marca.show~' ' %}
			{% set filtroMarca = ' de la marca '~filtros.marca.show %}
			{% set titleMarca = filtros.marca.show|title ~' | ' %}
			{% set keyMarca = 'autos '~filtros.marca.show~', ' %}
			{% endif %}
			{% if filtros.year is defined %}
			{% set showAnio = filtros.year.show~' ' %}
			{% set filtroAnio = ' '~filtros.year.show %}
			{% set titleAnio = filtros.year.show ~' | ' %}
			{% set keyAnio = 'autos '~filtros.year.show~', ' %}
			{% endif %}
			{% if filtros.ubicacion.show is defined %}
			{% set showUbicacion = filtros.ubicacion.show~' ' %}
			{% set filtroUbicacion = ' en '~filtros.ubicacion.show %}
			{% set titleUbicacion = filtros.ubicacion.show|title ~' | ' %}
			{% set keyUbicacion = 'autos '~filtros.ubicacion.show~', ' %}
			{% endif %}
			{% if filtros.motor.show is defined %}
			{% set showMotor = filtros.motor.show~' ' %}
			{% set filtroMotor = ' con motor '~filtros.motor.show %}
			{% set titleMotor = filtros.motor.show|title ~' | ' %}
			{% set keyMotor = 'autos '~filtros.motor.show~', ' %}
			{% endif %}
			{% if filtros.transmision.show is defined %}
			{% set showTransmision = filtros.transmision.show~' ' %}
			{% set filtroTransmision = ' con transmisión '~filtros.transmision.show %}
			{% set titleTransmision = filtros.transmision.show|title ~' | ' %}
			{% set keyTransmision = 'autos '~filtros.transmision.show~', ' %}
			{% endif %}
			{% if filtros.modelo.show is defined %}
			{% set showModelo = filtros.modelo.show~' ' %}
			{% set filtroModelo = ' modelo '~filtros.modelo.show %}
			{% set titleModelo = filtros.modelo.show|title ~' | ' %}
			{% set keyModelo = 'autos '~filtros.modelo.show~', ' %}
			{% endif %}
			{% set return_url = 'vehiculos/filtrar/'~return_url~'/' %}
			{% set keyword = keyMarca~keyAnio~keyUbicacion~keyMotor~keyTransmision~keyModelo %}
			<meta property="og:title" content="Ciro Automotores - Compra de autos usados en Salta y Jujuy {{showMarca}}{{showAnio}}{{showUbicacion}}{{showMotor}}{{showTransmision}}{{showModelo}}" />
			<meta property="og:description" content="¡Inicia sesión y compra los mejores autos usados en Salta y Jujuy además de autos 0 KM. Compra el auto{{filtroUbicacion}}{{filtroMotor}}{{filtroTransmision}}{{filtroAnio}}{{filtroMarca}}{{filtroModelo}}." />
			{% set metaDescription = 'Si buscas un auto'~filtroUbicacion~filtroMotor~filtroTransmision~filtroAnio~filtroMarca~filtroModelo~' en Ciro Automotores contamos con autos usados Salta y Jujuy al igual que autos 0 KM. ¡Visítanos!' %}
			{% if metaDescription|length > 165 %}
			<meta name="description" content="Si buscas un auto {{showMarca}}{{showAnio}}{{showUbicacion}}{{showMotor}}{{showTransmision}}{{showModelo}}en Ciro Automotores contamos con autos usados Salta y Jujuy al igual que autos 0 KM. ¡Visítanos!" />
			{% else %}
			<meta name="description" content="{{metaDescription}}" />
			{% endif %}
  		<meta name="keywords" content="{{ keyword|trim(', ', 'right') }}" />
			<title> {{titleMarca}}{{titleAnio}}{{titleUbicacion}}{{titleMotor}}{{titleTransmision}}{{titleModelo}}Iniciar Sesión | Ciro Automotores</title>
		{% else %}
			<meta property="og:title" content="Ciro Automotores - Inicia sesión y compra autos usados en Salta y Jujuy además tenemos autos 0 KM" />
			<meta property="og:description" content="¡Inicia sesión y hacé contacto con Ciro Automotores! Encontrá los mejores autos usados en Salta y Jujuy. ¡Te esperamos!" />
			<meta name="description" content="Te esperamos en Ciro Automotores donde podés encontrar autos usados en Salta y Jujuy. Además también hay autos 0 KM. ¡Hacé contacto!" />
  		<meta name="keywords" content="autos usados salta, autos usados en salta, autos 0 km" />
			<title> Autos Usados Salta | Iniciar sesión | Ciro Automotores</title>
		{% endif %}
		<base href="{{ base_url() }}">
		{% if production %}

		<link rel="stylesheet" href="//stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
		<link rel="stylesheet" href="/dist/css/login.min.css" />

		{% else %}

		<link rel="stylesheet" href="dev/css/bootstrap.min.css">			
		<link rel="stylesheet" href="dev/css/font-awesome.min.css"/>
		<link rel="stylesheet" href="/css/login.css" />

		{% endif %}
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-social/5.1.1/bootstrap-social.min.css" />

	</head>
	<body>
		<div class="container">			
			<form class="form-signup" action="{{ path_for('auth.signin') }}" method="post">

				<input type="hidden" name="return_to" value="{{return_url}}">
				<h2 class="form-signup-heading"><img src="{{static_assets}}/images/logo.png" class="login-logo" alt="Logo Ciro Automotores"></h2>
				<p class="text-muted">Completá los campos con tus datos de acceso.</p>

				{% include 'guest_views/guest_partials/fixed/flash.twig' %}
				<br>
				<div class="form-group{{ errors.car_email ? ' has-error' : '' }}">
					<label for="car_email" class="sr-only">Dirección de correo electrónico</label>
					<input type="text" id="car_email" name="car_email" class="form-control" placeholder="Dirección de correo electrónico" value="{{ old.car_email }}">
					{% if errors.car_email %}
						<span class="help-block">{{ errors.car_email | first }}</span>
					{% endif %}
				</div>

				<div class="form-group{{ errors.car_password ? ' has-error' : '' }}">
					<label for="car_password" class="sr-only">Contraseña</label>
					<input type="password" id="car_password" name="car_password" class="form-control" placeholder="Contraseña">
					{% if errors.car_password %}
						<span class="help-block">{{ errors.car_password | first }}</span>
					{% endif %}
				</div>
				<button class="btn btn-md btn-primary btn-block" type="submit" id="btn-signin">Iniciar sesión</button>
				<div class="row">	
					<div class="col-sm-12">
						<div class="social-buttons">
							<a class="btn btn-block btn-social btn-facebook btn-flat" href="#">
								<span class="fa fa-facebook"></span> Iniciar sesión con Facebook
							</a>
							<!--<div class="col-xs-6 login-facebook-col">
								
							</div>
							<div class="col-xs-6 login-google-col">
								<a class="btn btn-block btn-social btn-google" href="#">
									<span class="fa fa-google"></span> Entrar con Google
								</a>
							</div>-->
						</div>
					</div>
				</div>
				<div class="row">	
					<div class="col-sm-12">
						{% if 'vehiculos/filtrar/' in  return_url %}
							{% set return_to = return_url|replace({'vehiculos/filtrar/':''})|trim('/', 'right') %}
							<a href="{{ path_for('auth.signup',{'return_to':return_to}) }}" >Crear cuenta</a>
						{% else %}
							<a href="{{ path_for('auth.signup') }}{% if(return_url != '') %}/{{return_url}}{% endif %}">Crear cuenta</a>
						{% endif %}
						<a href="{{path_for('recuperar')}}" class="float-right">¿Olvidaste tu contraseña?</a>
					</div>
				</div>
				{{ csrf.field | raw }}
			</form>
		</div>
		{% if production %}

		<script src="//code.jquery.com/jquery-3.3.1.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
		<script src="//stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>	
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.threedubmedia/2.2/event.drag/jquery.event.drag.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>

		{% else %}

		<script type="text/javascript" src="dev/js/jquery-3.3.1.min.js"></script>
		<script type="text/javascript" src="dev/js/popper.min.js"></script>
		<script type="text/javascript" src="dev/js/bootstrap.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/jquery.threedubmedia/2.2/event.drag/jquery.event.drag.min.js"></script>
		<script type="text/javascript" src="dev/js/tether.min.js"></script>

		{% endif %}

		<script>
			function encodeDataToURL(data){
				return Object
					.keys(data)
					.map(value => `${value}=${encodeURIComponent(data[value])}`)
					.join('&');
			}
			$('.btn-facebook').click(function(e){
				e.preventDefault();
				FB.login(function(response)
					{
						if (response.status === 'connected') {
							GetUserData();
						}
					},
					{
						scope: 'public_profile,email'
					}
				);
			});

			function GetUserData() {
				/*
				Se obtiene:
					- La ID de Facebook del usuario, para guardarla en la base de datos
					y asi poder encontrar y gestionar los datos del mismo.
					- El nombre y el apellido del usuario
					- El email del usuario			
				*/
				FB.api('/me?fields=id,first_name,last_name,email', function(response) {
					
					var data = {
						'id_facebook':response.id,
						'nombre': response.first_name,
						'apellido': response.last_name,
						'email': response.email,
						'return_url': '{{return_url}}',
						'csrf_name': $('#csrf_name').val(),
						'csrf_value': $('#csrf_value').val()
					};

					$.ajax({
						url: "{{path_for('auth.facebook')}}",
						data: encodeDataToURL(data),
						method: "POST",
						cache: false,
						dataType: 'json',
						success: function( data ) {
							if(data.login == true) {
								if(data.return_url != "") {
									location.href = "{{base_url()}}/"+data.return_url;
								}
								else {
									if(data.first_login == true) {
										location.href = "{{path_for('auth.firstwelcome')}}";
									}
									else {
										location.href = "{{path_for('home')}}";
									}
								}								
							}
							else {
								if(data.reason == 'WRONG_ID') {
									alert('El email ya se encuentra registrado.');
								}
							}
						},
						complete: function (jqXHR) {
							var csrfToken = jqXHR.getResponseHeader('X-CSRF-Token');
							if (csrfToken) {
								try {
									csrfToken = $.parseJSON(csrfToken);
									var csrfTokenKeys = Object.keys(csrfToken);
									var hiddenFields = $('input.csrf[type="hidden"]');
									if (csrfTokenKeys.length === hiddenFields.length) {
										hiddenFields.each(function(i) {
											$(this).attr('name', csrfTokenKeys[i]);
											$(this).val(csrfToken[csrfTokenKeys[i]]);
										});
									}
								}
								catch (e) {

								}
							}
						}
					});
				});
			}

			(function(d, s, id){
			     var js, fjs = d.getElementsByTagName(s)[0];
			     if (d.getElementById(id)) return;
			     js = d.createElement(s); js.id = id;
			     js.src = "https://connect.facebook.net/es_LA/sdk.js";
			     fjs.parentNode.insertBefore(js, fjs);
			   }(document, 'script', 'facebook-jssdk'));

			window.fbAsyncInit = function() {
				FB.init({
					appId      : '1649443715119778',
					cookie     : true,
					xfbml      : true,
					version    : 'v2.8'
				});				
				FB.AppEvents.logPageView();
			};
		</script>
	</body>
</html>
